!function(e,n){for(var t in n)e[t]=n[t]}(exports,function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=3)}([function(e,n){e.exports=require("express")},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("passport")},function(e,n,t){(function(n){t(4).config();const o=t(5),r=t(0),s=t(6),i=t(7),u=t(1),c=t(8),a=t(2),l=t(11),f=t(12).Strategy,p=t(13),d=t(14),g=t(15),m=t(16),x=r(),T=process.env.PORT||"5000";try{const e=process.env.MONGODB_CLIENT_ID;u.connect(e,{useNewUrlParser:!0,useUnifiedTopology:!0},()=>console.log("Connected to Mongo Cluster!"))}catch(e){console.error(e)}x.use(o({origin:"http://localhost:"+T,methods:"GET,POST,PUT,DELETE",credentials:!0})),x.use(l({secret:"messidagoat",resave:!1,saveUninitialized:!1,store:g.create({mongoUrl:process.env.MONGODB_CLIENT_ID})})),x.use(i("dev")),x.use(r.json()),x.use(r.urlencoded({extended:!1})),x.use(s()),x.use(a.initialize()),x.use(a.session()),a.use(c.createStrategy()),a.serializeUser((function(e,n){n(null,e.id)})),a.deserializeUser((function(e,n){c.findById(e,(function(e,t){n(e,t)}))})),a.use(new f({clientID:process.env.SPOTIFY_CLIENT_ID,clientSecret:process.env.SPOTIFY_CLIENT_SECRET,callbackURL:process.env.REDIRECT_URI},(function(e,n,t,o,r){c.findOrCreate({spotifyId:o.id},{name:o.displayName,refreshToken:n,accessToken:e},(function(t,s){return s.accessToken!==e&&c.findOneAndUpdate({spotifyId:o.id},{accessToken:e,refreshToken:n},{new:!0,lean:!0},(function(e,n){e&&console.log("Something wrong when updating data!"),s=n})),r(t,s)}))}))),x.use("/.netlify/functions/app",m),x.use(r.static(d.join(n,"../client/build"))),x.use("/",(e,t)=>{t.sendFile(d.join(n,"../client/build/index.html"))}),e.exports=x,e.exports.handler=p(x)}).call(this,"/")},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("cookie-parser")},function(e,n){e.exports=require("morgan")},function(e,n,t){const{default:o}=t(1),r=t(9),s=t(10),i=new(0,o.Schema)({name:String,spotifyId:String,secret:String,refreshToken:String,accessToken:String});i.plugin(r),i.plugin(s),global.User=global.User||o.model("User",i),e.exports=global.User},function(e,n){e.exports=require("passport-local-mongoose")},function(e,n){e.exports=require("mongoose-findorcreate")},function(e,n){e.exports=require("express-session")},function(e,n){e.exports=require("passport-spotify")},function(e,n){e.exports=require("serverless-http")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("connect-mongo")},function(e,n,t){var o=t(0).Router();const r=t(2),s=t(17);o.get("/login",r.authenticate("spotify",{scope:["user-read-email","user-read-private","user-top-read"],showDialog:!0})),o.get("/callback",r.authenticate("spotify",{failureRedirect:"/login/failed"}),(function(e,n){n.redirect("/")})),o.get("/refresh_token",(function(e,n){const t=process.env.SPOTIFY_CLIENT_ID,o=process.env.SPOTIFY_CLIENT_SECRET,r=e.user.refreshToken,i={url:"https://accounts.spotify.com/api/token",headers:{Authorization:"Basic "+new Buffer.from(t+":"+o).toString("base64")},form:{grant_type:"refresh_token",refresh_token:r},json:!0};s.post(i,(function(e,t,o){if(!e&&200===t.statusCode){const e=o.access_token;n.send({access_token:e})}}))})),o.get("/login/failed",(e,n)=>{n.status(401).json({success:!1,message:"login failure"})}),o.get("/login/success",(e,n)=>{e.user?n.status(200).json({success:!0,message:"user logged in",user:e.user}):n.status(401).json({success:!1,message:"user not logged in"})}),o.get("/logout",(function(e,n){e.logout((function(e){e||n.redirect("/login")}))})),e.exports=o},function(e,n){e.exports=require("postman-request")}]));